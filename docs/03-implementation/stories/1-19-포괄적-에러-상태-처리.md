# Story 1.19: í¬ê´„ì  ì—ëŸ¬ ìƒíƒœ ì²˜ë¦¬

**Status:** ğŸ“‹ TODO

**Priority:** ğŸŸ¡ MEDIUM

**Type:** ğŸ”§ Enhancement

---

## User Story

**As a** ì‚¬ìš©ì,
**I want** API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ì™€ ë³µêµ¬ ì˜µì…˜ì„ ë³´ê³ ,
**So that** ë¬¸ì œì˜ ì›ì¸ì„ ì´í•´í•˜ê³  ì ì ˆí•œ ì¡°ì¹˜ë¥¼ ì·¨í•  ìˆ˜ ìˆë‹¤.

---

## Context

**ë°°ê²½:**
PR #45ì—ì„œ loading state ì²˜ë¦¬ë¥¼ ê°œì„ í•˜ë©´ì„œ ì¼ë¶€ í˜ì´ì§€ì— ê¸°ë³¸ì ì¸ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ í˜„ì¬ëŠ” ì£¼ë¡œ mutationì˜ `onError` ì½œë°±ì—ì„œ toast ë©”ì‹œì§€ë¡œë§Œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ê³  ìˆì–´, query ì‹¤íŒ¨ ì‹œì˜ ì „ì²´ í˜ì´ì§€ ì—ëŸ¬ ìƒíƒœ ì²˜ë¦¬ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.

**í˜„ì¬ ìƒí™© (PR #45 ì´í›„):**
```typescript
// âœ… Mutation ì—ëŸ¬ ì²˜ë¦¬ (ì™„ë£Œ)
const createTeam = api.team.create.useMutation({
  onSuccess: () => {
    toast.success("íŒ€ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤");
  },
  onError: (error) => {
    toast.error(error.message);
  },
});

// âš ï¸ Query ì—ëŸ¬ ì²˜ë¦¬ (ê°œì„  í•„ìš”)
const { data: projects, isLoading, isError, error } = api.project.getAll.useQuery();

if (isLoading) return <Loader2 />; // âœ… Loading ì²˜ë¦¬ ì™„ë£Œ
if (isError) return <div>ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</div>; // âš ï¸ ê°œì„  í•„ìš”
```

**ê°œì„ ì´ í•„ìš”í•œ ì˜ì—­:**

1. **Query ì—ëŸ¬ UI ê°œì„ **
   - í˜„ì¬: ê°„ë‹¨í•œ í…ìŠ¤íŠ¸ ë©”ì‹œì§€
   - ëª©í‘œ: ì—ëŸ¬ ìœ í˜•ë³„ ë§ì¶¤ ë©”ì‹œì§€ + ì¬ì‹œë„ ë²„íŠ¼

2. **ì—ëŸ¬ ìœ í˜• ë¶„ë¥˜**
   - ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ (ì˜¤í”„ë¼ì¸, íƒ€ì„ì•„ì›ƒ)
   - ì¸ì¦ ì—ëŸ¬ (401, 403)
   - ê¶Œí•œ ì—ëŸ¬ (404)
   - ì„œë²„ ì—ëŸ¬ (500, 503)
   - ìœ íš¨ì„± ê²€ì¦ ì—ëŸ¬ (400)

3. **ë³µêµ¬ ì˜µì…˜ ì œê³µ**
   - ì¬ì‹œë„ ë²„íŠ¼
   - í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
   - ìƒˆë¡œê³ ì¹¨
   - ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜

4. **ì‚¬ìš©ì ì¹œí™”ì  ë©”ì‹œì§€**
   - ê¸°ìˆ ì  ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì‚¬ìš©ìê°€ ì´í•´í•  ìˆ˜ ìˆëŠ” ì–¸ì–´ë¡œ ë³€í™˜
   - í•œêµ­ì–´ ë©”ì‹œì§€ ì œê³µ
   - ë‹¤ìŒ ì•¡ì…˜ ì œì•ˆ

---

## Related Work

**ì„ í–‰ ì‘ì—…:**
- âœ… PR #45: Loading states to prevent premature UI rendering
  - isLoading ì²´í¬ ì¶”ê°€
  - ê¸°ë³¸ isError ì²´í¬ ì¶”ê°€
  - Mutation onError ì²˜ë¦¬

**ì´ ìŠ¤í† ë¦¬ì˜ ë²”ìœ„:**
- Query ì—ëŸ¬ ìƒíƒœë¥¼ ìœ„í•œ ì „ìš© Error UI ì»´í¬ë„ŒíŠ¸
- ì—ëŸ¬ ìœ í˜•ë³„ ë§ì¶¤ ë©”ì‹œì§€
- ë³µêµ¬ ì˜µì…˜ ì œê³µ
- ì—ëŸ¬ ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§ ì¤€ë¹„

**ê´€ë ¨ ìŠ¤í† ë¦¬:**
- Story 1.18: Skeleton States (UX ì¼ê´€ì„±)
- Story 1.11: ë³´ì•ˆ ê°•í™” (ì—ëŸ¬ì—ì„œ ë¯¼ê° ì •ë³´ ë…¸ì¶œ ë°©ì§€)

---

## Acceptance Criteria

### í•„ìˆ˜ ìš”êµ¬ì‚¬í•­

#### 1. Error UI ì»´í¬ë„ŒíŠ¸ ìƒì„±
- [ ] ë²”ìš© `ErrorFallback` ì»´í¬ë„ŒíŠ¸
- [ ] ì—ëŸ¬ ìœ í˜•ë³„ ì•„ì´ì½˜ê³¼ ìƒ‰ìƒ
- [ ] ì¬ì‹œë„ ë²„íŠ¼ í¬í•¨
- [ ] ë°˜ì‘í˜• ë””ìì¸ (ëª¨ë°”ì¼ ì§€ì›)

#### 2. ì—ëŸ¬ ìœ í˜• ë¶„ë¥˜ ë° ë©”ì‹œì§€
- [ ] ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ê°ì§€ ë° ë©”ì‹œì§€
- [ ] ì¸ì¦ ì—ëŸ¬ ì²˜ë¦¬ (ìë™ ë¡œê·¸ì•„ì›ƒ)
- [ ] ê¶Œí•œ ì—ëŸ¬ ë©”ì‹œì§€
- [ ] ì„œë²„ ì—ëŸ¬ ë©”ì‹œì§€
- [ ] ìœ íš¨ì„± ê²€ì¦ ì—ëŸ¬ ë©”ì‹œì§€

#### 3. ì£¼ìš” í˜ì´ì§€ ì—ëŸ¬ ì²˜ë¦¬
- [ ] Dashboard í˜ì´ì§€
- [ ] Projects í˜ì´ì§€
- [ ] Settings í˜ì´ì§€
- [ ] Reports í˜ì´ì§€
- [ ] Team members í˜ì´ì§€

#### 4. ì—ëŸ¬ ë¡œê¹…
- [ ] í´ë¼ì´ì–¸íŠ¸ ì—ëŸ¬ë¥¼ ë¡œê±°ë¡œ ê¸°ë¡
- [ ] ì—ëŸ¬ ì»¨í…ìŠ¤íŠ¸ ì •ë³´ í¬í•¨ (userId, url, timestamp)
- [ ] í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œë§Œ ë¡œê¹…

#### 5. ì—ëŸ¬ ê²½ê³„ (Error Boundary)
- [ ] React Error Boundary ì„¤ì •
- [ ] ì˜ˆìƒì¹˜ ëª»í•œ ì—ëŸ¬ catch
- [ ] ì „ì²´ ì•± í¬ë˜ì‹œ ë°©ì§€

---

## Technical Implementation

### 1. Error Utilities

**src/lib/error-utils.ts (NEW FILE):**
```typescript
import { TRPCClientError } from "@trpc/client";
import { logger } from "~/lib/logger";

export type ErrorType =
  | "NETWORK_ERROR"
  | "AUTHENTICATION_ERROR"
  | "AUTHORIZATION_ERROR"
  | "NOT_FOUND"
  | "VALIDATION_ERROR"
  | "SERVER_ERROR"
  | "UNKNOWN_ERROR";

export interface ClassifiedError {
  type: ErrorType;
  title: string;
  message: string;
  userMessage: string;
  canRetry: boolean;
  shouldLogout: boolean;
}

/**
 * tRPC ì—ëŸ¬ë¥¼ ë¶„ë¥˜í•˜ê³  ì‚¬ìš©ì ì¹œí™”ì ì¸ ë©”ì‹œì§€ë¡œ ë³€í™˜
 */
export function classifyError(error: unknown): ClassifiedError {
  // Network errors (fetch failed, timeout)
  if (error instanceof TypeError && error.message.includes("fetch")) {
    return {
      type: "NETWORK_ERROR",
      title: "ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì˜¤ë¥˜",
      message: error.message,
      userMessage:
        "ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”. ë„¤íŠ¸ì›Œí¬ê°€ ë¶ˆì•ˆì •í•˜ê±°ë‚˜ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
      canRetry: true,
      shouldLogout: false,
    };
  }

  // tRPC errors
  if (error instanceof TRPCClientError) {
    const statusCode = error.data?.httpStatus;

    switch (statusCode) {
      case 401:
        return {
          type: "AUTHENTICATION_ERROR",
          title: "ì¸ì¦ ì˜¤ë¥˜",
          message: error.message,
          userMessage:
            "ë¡œê·¸ì¸ì´ í•„ìš”í•˜ê±°ë‚˜ ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.",
          canRetry: false,
          shouldLogout: true,
        };

      case 403:
        return {
          type: "AUTHORIZATION_ERROR",
          title: "ê¶Œí•œ ì˜¤ë¥˜",
          message: error.message,
          userMessage: "ì´ ì‘ì—…ì„ ìˆ˜í–‰í•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.",
          canRetry: false,
          shouldLogout: false,
        };

      case 404:
        return {
          type: "NOT_FOUND",
          title: "ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ",
          message: error.message,
          userMessage: "ìš”ì²­í•œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‚­ì œë˜ì—ˆê±°ë‚˜ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
          canRetry: false,
          shouldLogout: false,
        };

      case 400:
        return {
          type: "VALIDATION_ERROR",
          title: "ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨",
          message: error.message,
          userMessage: "ì…ë ¥í•œ ë°ì´í„°ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.",
          canRetry: false,
          shouldLogout: false,
        };

      case 500:
      case 502:
      case 503:
      case 504:
        return {
          type: "SERVER_ERROR",
          title: "ì„œë²„ ì˜¤ë¥˜",
          message: error.message,
          userMessage:
            "ì„œë²„ì— ì¼ì‹œì ì¸ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
          canRetry: true,
          shouldLogout: false,
        };
    }
  }

  // Unknown errors
  return {
    type: "UNKNOWN_ERROR",
    title: "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜",
    message: error instanceof Error ? error.message : String(error),
    userMessage: "ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë¬¸ì œê°€ ì§€ì†ë˜ë©´ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.",
    canRetry: true,
    shouldLogout: false,
  };
}

/**
 * ì—ëŸ¬ë¥¼ ë¡œê¹…í•˜ê³  ë¶„ì„ì„ ìœ„í•œ ì»¨í…ìŠ¤íŠ¸ ì •ë³´ í¬í•¨
 */
export function logError(
  error: unknown,
  context: {
    userId?: string;
    url?: string;
    componentName?: string;
    action?: string;
  }
) {
  const classified = classifyError(error);

  logger.error("Client error occurred", {
    errorType: classified.type,
    errorTitle: classified.title,
    errorMessage: classified.message,
    userId: context.userId,
    url: context.url || (typeof window !== "undefined" ? window.location.href : undefined),
    componentName: context.componentName,
    action: context.action,
    timestamp: new Date().toISOString(),
    userAgent: typeof navigator !== "undefined" ? navigator.userAgent : undefined,
  });

  return classified;
}
```

### 2. Error Fallback Component

**src/components/errors/error-fallback.tsx (NEW FILE):**
```typescript
import { AlertCircle, RefreshCw, Home, WifiOff, Lock } from "lucide-react";
import { Button } from "~/components/ui/button";
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from "~/components/ui/card";
import { Alert, AlertDescription, AlertTitle } from "~/components/ui/alert";
import { classifyError, type ErrorType } from "~/lib/error-utils";
import { useRouter } from "next/navigation";
import { signOut } from "next-auth/react";

interface ErrorFallbackProps {
  error: unknown;
  onRetry?: () => void;
  componentName?: string;
}

const ERROR_ICONS: Record<ErrorType, typeof AlertCircle> = {
  NETWORK_ERROR: WifiOff,
  AUTHENTICATION_ERROR: Lock,
  AUTHORIZATION_ERROR: Lock,
  NOT_FOUND: AlertCircle,
  VALIDATION_ERROR: AlertCircle,
  SERVER_ERROR: AlertCircle,
  UNKNOWN_ERROR: AlertCircle,
};

export function ErrorFallback({ error, onRetry, componentName }: ErrorFallbackProps) {
  const router = useRouter();
  const classified = classifyError(error);
  const Icon = ERROR_ICONS[classified.type];

  const handleRetry = () => {
    if (onRetry) {
      onRetry();
    } else {
      router.refresh();
    }
  };

  const handleGoHome = () => {
    router.push("/dashboard");
  };

  const handleLogout = async () => {
    await signOut({ callbackUrl: "/login" });
  };

  return (
    <div className="flex min-h-[50vh] items-center justify-center p-4">
      <Card className="w-full max-w-md">
        <CardHeader>
          <div className="flex items-center space-x-2">
            <Icon className="h-6 w-6 text-destructive" />
            <CardTitle>{classified.title}</CardTitle>
          </div>
          <CardDescription>{classified.userMessage}</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          {/* ê°œë°œ í™˜ê²½ì—ì„œë§Œ ê¸°ìˆ ì  ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ */}
          {process.env.NODE_ENV === "development" && (
            <Alert variant="destructive">
              <AlertTitle>ê¸°ìˆ ì  ìƒì„¸ ì •ë³´ (ê°œë°œ ëª¨ë“œ)</AlertTitle>
              <AlertDescription className="mt-2 text-sm font-mono">
                {classified.message}
                {componentName && (
                  <div className="mt-1 text-xs opacity-70">
                    Component: {componentName}
                  </div>
                )}
              </AlertDescription>
            </Alert>
          )}

          {/* ì•¡ì…˜ ë²„íŠ¼ë“¤ */}
          <div className="flex flex-col gap-2">
            {classified.canRetry && onRetry && (
              <Button onClick={handleRetry} variant="default" className="w-full">
                <RefreshCw className="mr-2 h-4 w-4" />
                ë‹¤ì‹œ ì‹œë„
              </Button>
            )}

            {classified.shouldLogout ? (
              <Button
                onClick={handleLogout}
                variant="outline"
                className="w-full"
              >
                <Lock className="mr-2 h-4 w-4" />
                ë‹¤ì‹œ ë¡œê·¸ì¸
              </Button>
            ) : (
              <Button onClick={handleGoHome} variant="outline" className="w-full">
                <Home className="mr-2 h-4 w-4" />
                í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
              </Button>
            )}
          </div>

          {/* ë„ì›€ë§ */}
          <p className="text-center text-sm text-muted-foreground">
            ë¬¸ì œê°€ ì§€ì†ë˜ë©´{" "}
            <a
              href="mailto:support@example.com"
              className="underline hover:text-foreground"
            >
              ê³ ê° ì§€ì›
            </a>
            ì— ë¬¸ì˜í•˜ì„¸ìš”.
          </p>
        </CardContent>
      </Card>
    </div>
  );
}

/**
 * Inline ì—ëŸ¬ í‘œì‹œ (í˜ì´ì§€ ì „ì²´ê°€ ì•„ë‹Œ ì„¹ì…˜ë³„ ì—ëŸ¬)
 */
export function InlineErrorFallback({ error, onRetry }: ErrorFallbackProps) {
  const classified = classifyError(error);
  const Icon = ERROR_ICONS[classified.type];

  return (
    <Alert variant="destructive">
      <Icon className="h-4 w-4" />
      <AlertTitle>{classified.title}</AlertTitle>
      <AlertDescription className="mt-2 flex items-center justify-between">
        <span>{classified.userMessage}</span>
        {classified.canRetry && onRetry && (
          <Button
            onClick={onRetry}
            variant="outline"
            size="sm"
            className="ml-4"
          >
            <RefreshCw className="mr-2 h-4 w-4" />
            ì¬ì‹œë„
          </Button>
        )}
      </AlertDescription>
    </Alert>
  );
}
```

### 3. React Error Boundary

**src/components/errors/error-boundary.tsx (NEW FILE):**
```typescript
"use client";

import React from "react";
import { ErrorFallback } from "./error-fallback";
import { logError } from "~/lib/error-utils";

interface ErrorBoundaryProps {
  children: React.ReactNode;
  fallback?: React.ComponentType<{ error: Error; reset: () => void }>;
  onError?: (error: Error, errorInfo: React.ErrorInfo) => void;
}

interface ErrorBoundaryState {
  hasError: boolean;
  error: Error | null;
}

/**
 * React Error Boundary to catch unexpected errors
 */
export class ErrorBoundary extends React.Component<
  ErrorBoundaryProps,
  ErrorBoundaryState
> {
  constructor(props: ErrorBoundaryProps) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error: Error): ErrorBoundaryState {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    // ì—ëŸ¬ ë¡œê¹…
    logError(error, {
      componentName: "ErrorBoundary",
      action: "componentDidCatch",
    });

    // ì»¤ìŠ¤í…€ ì—ëŸ¬ í•¸ë“¤ëŸ¬ ì‹¤í–‰
    this.props.onError?.(error, errorInfo);
  }

  reset = () => {
    this.setState({ hasError: false, error: null });
  };

  render() {
    if (this.state.hasError && this.state.error) {
      // ì»¤ìŠ¤í…€ fallbackì´ ìˆìœ¼ë©´ ì‚¬ìš©
      if (this.props.fallback) {
        const FallbackComponent = this.props.fallback;
        return <FallbackComponent error={this.state.error} reset={this.reset} />;
      }

      // ê¸°ë³¸ ErrorFallback ì‚¬ìš©
      return <ErrorFallback error={this.state.error} onRetry={this.reset} />;
    }

    return this.props.children;
  }
}
```

### 4. Dashboard Page with Error Handling

**src/app/(dashboard)/dashboard/page.tsx ìˆ˜ì •:**
```typescript
"use client";

import { useSession } from "next-auth/react";
import { DashboardSkeleton } from "~/components/skeletons/dashboard-skeleton";
import { ErrorFallback } from "~/components/errors/error-fallback";
import { logError } from "~/lib/error-utils";
import { api } from "~/trpc/react";

export default function DashboardPage() {
  const { data: session } = useSession();

  const {
    data: stats,
    isLoading,
    isError,
    error,
    refetch,
  } = api.dashboard.getStats.useQuery(
    {},
    {
      staleTime: 5 * 60 * 1000,
      gcTime: 10 * 60 * 1000,
      retry: 3,
    }
  );

  // ë¡œë”© ìƒíƒœ
  if (isLoading) {
    return <DashboardSkeleton />;
  }

  // ì—ëŸ¬ ìƒíƒœ - ë¡œê¹… ë° ErrorFallback í‘œì‹œ
  if (isError) {
    logError(error, {
      userId: session?.user?.id,
      componentName: "DashboardPage",
      action: "getStats query",
    });

    return (
      <ErrorFallback
        error={error}
        onRetry={() => void refetch()}
        componentName="DashboardPage"
      />
    );
  }

  // ì •ìƒ ìƒíƒœ
  return (
    <div className="space-y-8">
      {/* Dashboard content */}
    </div>
  );
}
```

### 5. Projects Page with Error Handling

**src/app/(dashboard)/projects/page.tsx ìˆ˜ì •:**
```typescript
"use client";

import { useSession } from "next-auth/react";
import { ProjectsSkeleton } from "~/components/skeletons/projects-skeleton";
import { ErrorFallback, InlineErrorFallback } from "~/components/errors/error-fallback";
import { logError } from "~/lib/error-utils";
import { api } from "~/trpc/react";

export default function ProjectsPage() {
  const { data: session } = useSession();

  const {
    data: projects,
    isLoading,
    isError,
    error,
    refetch,
  } = api.project.getAll.useQuery(
    {},
    {
      staleTime: 60 * 1000,
      retry: 3,
    }
  );

  if (isLoading) {
    return <ProjectsSkeleton />;
  }

  if (isError) {
    logError(error, {
      userId: session?.user?.id,
      componentName: "ProjectsPage",
      action: "getAll query",
    });

    return (
      <ErrorFallback
        error={error}
        onRetry={() => void refetch()}
        componentName="ProjectsPage"
      />
    );
  }

  // Empty stateëŠ” ì—ëŸ¬ê°€ ì•„ë‹˜
  if (!projects || projects.length === 0) {
    return (
      <div className="flex flex-col items-center justify-center py-12">
        <h2 className="text-2xl font-semibold">í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</h2>
        <p className="mt-2 text-muted-foreground">
          ì²« í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”
        </p>
        <Button className="mt-4" onClick={() => {/* open create dialog */}}>
          í”„ë¡œì íŠ¸ ìƒì„±
        </Button>
      </div>
    );
  }

  return (
    <div className="space-y-8">
      {/* Projects content */}
    </div>
  );
}
```

### 6. Settings Page with Inline Error

**src/app/(dashboard)/projects/[id]/settings/page.tsx ìˆ˜ì •:**
```typescript
"use client";

import { useParams } from "next/navigation";
import { useSession } from "next-auth/react";
import { SettingsSkeleton } from "~/components/skeletons/settings-skeleton";
import { InlineErrorFallback } from "~/components/errors/error-fallback";
import { logError } from "~/lib/error-utils";
import { api } from "~/trpc/react";

export default function ProjectSettingsPage() {
  const params = useParams();
  const projectId = params.id as string;
  const { data: session } = useSession();

  const {
    data: project,
    isLoading: isLoadingProject,
    isError: isProjectError,
    error: projectError,
    refetch: refetchProject,
  } = api.project.getById.useQuery(
    { id: projectId },
    {
      staleTime: 5 * 60 * 1000,
      gcTime: 10 * 60 * 1000,
    }
  );

  const {
    data: alerts,
    isLoading: isLoadingAlerts,
    isError: isAlertsError,
    error: alertsError,
    refetch: refetchAlerts,
  } = api.alert.getAlerts.useQuery(
    { projectId },
    {
      staleTime: 5 * 60 * 1000,
    }
  );

  if (isLoadingProject || isLoadingAlerts) {
    return <SettingsSkeleton />;
  }

  // í”„ë¡œì íŠ¸ ë¡œë”© ì‹¤íŒ¨ëŠ” ì „ì²´ í˜ì´ì§€ ì—ëŸ¬
  if (isProjectError) {
    logError(projectError, {
      userId: session?.user?.id,
      componentName: "ProjectSettingsPage",
      action: "getById query",
    });

    return (
      <ErrorFallback
        error={projectError}
        onRetry={() => void refetchProject()}
        componentName="ProjectSettingsPage"
      />
    );
  }

  return (
    <div className="space-y-8">
      <h1 className="text-3xl font-bold">{project.name} ì„¤ì •</h1>

      {/* ì•Œë¦¼ ì„¤ì • ì„¹ì…˜ - inline ì—ëŸ¬ */}
      <Card>
        <CardHeader>
          <CardTitle>ì•Œë¦¼ ì„¤ì •</CardTitle>
        </CardHeader>
        <CardContent>
          {isAlertsError ? (
            <InlineErrorFallback
              error={alertsError}
              onRetry={() => void refetchAlerts()}
            />
          ) : (
            // Alert settings form
            <></>
          )}
        </CardContent>
      </Card>

      {/* Other settings sections */}
    </div>
  );
}
```

### 7. Root Layout Error Boundary

**src/app/layout.tsx ìˆ˜ì •:**
```typescript
import { ErrorBoundary } from "~/components/errors/error-boundary";

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="ko">
      <body className={inter.className}>
        <ErrorBoundary>
          <TRPCReactProvider>
            <SessionProvider>
              {children}
            </SessionProvider>
          </TRPCReactProvider>
        </ErrorBoundary>
        <Toaster />
      </body>
    </html>
  );
}
```

---

## Testing Plan

### 1. Unit Tests

```typescript
// __tests__/unit/error-utils.test.ts
import { classifyError } from "~/lib/error-utils";
import { TRPCClientError } from "@trpc/client";

describe("Error Classification", () => {
  it("should classify network errors", () => {
    const error = new TypeError("fetch failed");
    const classified = classifyError(error);

    expect(classified.type).toBe("NETWORK_ERROR");
    expect(classified.canRetry).toBe(true);
    expect(classified.shouldLogout).toBe(false);
  });

  it("should classify 401 as authentication error", () => {
    const error = new TRPCClientError("Unauthorized", {
      data: { httpStatus: 401 },
    });
    const classified = classifyError(error);

    expect(classified.type).toBe("AUTHENTICATION_ERROR");
    expect(classified.shouldLogout).toBe(true);
  });

  it("should classify 403 as authorization error", () => {
    const error = new TRPCClientError("Forbidden", {
      data: { httpStatus: 403 },
    });
    const classified = classifyError(error);

    expect(classified.type).toBe("AUTHORIZATION_ERROR");
    expect(classified.shouldLogout).toBe(false);
  });

  it("should classify 500 as server error", () => {
    const error = new TRPCClientError("Internal Server Error", {
      data: { httpStatus: 500 },
    });
    const classified = classifyError(error);

    expect(classified.type).toBe("SERVER_ERROR");
    expect(classified.canRetry).toBe(true);
  });
});
```

### 2. Component Tests

```typescript
// __tests__/components/error-fallback.test.tsx
import { render, screen, fireEvent } from "@testing-library/react";
import { ErrorFallback } from "~/components/errors/error-fallback";
import { TRPCClientError } from "@trpc/client";

describe("ErrorFallback Component", () => {
  it("should render error message", () => {
    const error = new Error("Test error");
    render(<ErrorFallback error={error} />);

    expect(screen.getByText(/ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜/i)).toBeInTheDocument();
  });

  it("should show retry button for retryable errors", () => {
    const error = new TypeError("fetch failed");
    const onRetry = vi.fn();

    render(<ErrorFallback error={error} onRetry={onRetry} />);

    const retryButton = screen.getByText(/ë‹¤ì‹œ ì‹œë„/i);
    expect(retryButton).toBeInTheDocument();

    fireEvent.click(retryButton);
    expect(onRetry).toHaveBeenCalledTimes(1);
  });

  it("should show logout button for auth errors", () => {
    const error = new TRPCClientError("Unauthorized", {
      data: { httpStatus: 401 },
    });

    render(<ErrorFallback error={error} />);

    expect(screen.getByText(/ë‹¤ì‹œ ë¡œê·¸ì¸/i)).toBeInTheDocument();
  });

  it("should not show technical details in production", () => {
    const originalEnv = process.env.NODE_ENV;
    process.env.NODE_ENV = "production";

    const error = new Error("Technical error message");
    render(<ErrorFallback error={error} />);

    expect(screen.queryByText(/Technical error message/i)).not.toBeInTheDocument();

    process.env.NODE_ENV = originalEnv;
  });
});
```

### 3. E2E Tests

```typescript
// __tests__/e2e/error-handling.spec.ts
import { test, expect } from "@playwright/test";
import { setupTestUser } from "./helpers";

test.describe("Error Handling", () => {
  test("should show error fallback when API fails", async ({ page }) => {
    await setupTestUser(page);

    // Intercept API and return error
    await page.route("**/api/trpc/dashboard.getStats*", async (route) => {
      await route.fulfill({
        status: 500,
        body: JSON.stringify({ error: "Internal Server Error" }),
      });
    });

    await page.goto("/dashboard");

    // Should show error fallback
    await expect(page.locator("text=/ì„œë²„ ì˜¤ë¥˜/i")).toBeVisible();
    await expect(page.locator("text=/ë‹¤ì‹œ ì‹œë„/i")).toBeVisible();
  });

  test("should retry on button click", async ({ page }) => {
    await setupTestUser(page);

    let requestCount = 0;
    await page.route("**/api/trpc/dashboard.getStats*", async (route) => {
      requestCount++;
      if (requestCount === 1) {
        // First request fails
        await route.fulfill({
          status: 500,
          body: JSON.stringify({ error: "Server Error" }),
        });
      } else {
        // Second request succeeds
        await route.continue();
      }
    });

    await page.goto("/dashboard");

    // Wait for error
    await expect(page.locator("text=/ì„œë²„ ì˜¤ë¥˜/i")).toBeVisible();

    // Click retry
    await page.click("text=/ë‹¤ì‹œ ì‹œë„/i");

    // Should show dashboard after retry
    await expect(page.locator("text=/Dashboard/i")).toBeVisible();
  });

  test("should logout on 401 error", async ({ page }) => {
    await setupTestUser(page);

    await page.route("**/api/trpc/dashboard.getStats*", async (route) => {
      await route.fulfill({
        status: 401,
        body: JSON.stringify({ error: "Unauthorized" }),
      });
    });

    await page.goto("/dashboard");

    // Should show login button
    await expect(page.locator("text=/ë‹¤ì‹œ ë¡œê·¸ì¸/i")).toBeVisible();

    // Click login button
    await page.click("text=/ë‹¤ì‹œ ë¡œê·¸ì¸/i");

    // Should redirect to login page
    await expect(page).toHaveURL(/\/login/);
  });
});
```

---

## Definition of Done

- [ ] `error-utils.ts` ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ êµ¬í˜„ ì™„ë£Œ
- [ ] `ErrorFallback` ì»´í¬ë„ŒíŠ¸ ìƒì„±
- [ ] `InlineErrorFallback` ì»´í¬ë„ŒíŠ¸ ìƒì„±
- [ ] React `ErrorBoundary` êµ¬í˜„
- [ ] Dashboard, Projects, Settings, Reports í˜ì´ì§€ì— ì—ëŸ¬ ì²˜ë¦¬ ì¶”ê°€
- [ ] ì—ëŸ¬ ë¡œê¹… ì„¤ì • ì™„ë£Œ
- [ ] ëª¨ë“  ì—ëŸ¬ ìœ í˜•ì— ëŒ€í•œ í•œêµ­ì–´ ë©”ì‹œì§€ ì œê³µ
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± ë° í†µê³¼
- [ ] ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸ ì‘ì„± ë° í†µê³¼
- [ ] E2E í…ŒìŠ¤íŠ¸ ì‘ì„± ë° í†µê³¼
- [ ] í”„ë¡œë•ì…˜ì—ì„œ ë¯¼ê° ì •ë³´ ë…¸ì¶œ ë°©ì§€ í™•ì¸
- [ ] ë¬¸ì„œí™” ì™„ë£Œ
- [ ] íŒ€ ë¦¬ë·° ë° ìŠ¹ì¸

---

## Dependencies

**Blocked By:**
- âœ… PR #45: Loading states to prevent premature UI rendering

**Blocks:**
- None

**Related Stories:**
- Story 1.18: Skeleton States (ì¼ê´€ëœ UX)
- Story 1.11: ë³´ì•ˆ ê°•í™” (ì—ëŸ¬ì—ì„œ ë¯¼ê° ì •ë³´ ë…¸ì¶œ ë°©ì§€)

---

## Estimation

**Story Points:** 5

**Time Estimate:**
- Error utilities êµ¬í˜„: 2ì‹œê°„
- ErrorFallback ì»´í¬ë„ŒíŠ¸: 2ì‹œê°„
- ErrorBoundary êµ¬í˜„: 1.5ì‹œê°„
- í˜ì´ì§€ë³„ ì—ëŸ¬ ì²˜ë¦¬ ì ìš©: 3ì‹œê°„
- ì—ëŸ¬ ë¡œê¹… ì„¤ì •: 1ì‹œê°„
- í…ŒìŠ¤íŠ¸ ì‘ì„±: 3ì‹œê°„
- E2E í…ŒìŠ¤íŠ¸: 2ì‹œê°„
- ë¬¸ì„œí™”: 1ì‹œê°„
- **Total:** ~15.5ì‹œê°„

---

## References

- [React Error Boundaries](https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary)
- [TanStack Query Error Handling](https://tanstack.com/query/v5/docs/react/guides/query-functions#handling-and-throwing-errors)
- [tRPC Error Handling](https://trpc.io/docs/client/react/useQuery#handling-errors)
- [User-Friendly Error Messages](https://www.nngroup.com/articles/error-message-guidelines/)
- [PR #45: Loading states improvement](https://github.com/jawsbaek/finops-for-ai-sds/pull/45)

---

## Technical Notes

### ì—ëŸ¬ ì²˜ë¦¬ ë ˆë²¨

**1. Global Error Boundary (App Level)**
- ì˜ˆìƒì¹˜ ëª»í•œ React ì—ëŸ¬ catch
- ì „ì²´ ì•± í¬ë˜ì‹œ ë°©ì§€
- ìµœí›„ì˜ ë°©ì–´ì„ 

**2. Page Error Fallback (Page Level)**
- Query ì‹¤íŒ¨ ì‹œ í˜ì´ì§€ ì „ì²´ ì—ëŸ¬ UI
- ì¬ì‹œë„ ë²„íŠ¼ ì œê³µ
- í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸° ì˜µì…˜

**3. Inline Error (Section Level)**
- í˜ì´ì§€ ì¼ë¶€ ì„¹ì…˜ì˜ ì—ëŸ¬
- ë‚˜ë¨¸ì§€ í˜ì´ì§€ëŠ” ì •ìƒ ì‘ë™
- ìµœì†Œí•œì˜ UX ì˜í–¥

**4. Toast Notification (Action Level)**
- Mutation ì‹¤íŒ¨ ì‹œ ê°„ë‹¨í•œ ì•Œë¦¼
- í˜ì´ì§€ ì „í™˜ ì—†ìŒ
- ë¹ ë¥¸ í”¼ë“œë°±

### ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

**í”„ë¡œë•ì…˜ì—ì„œ ìˆ¨ê²¨ì•¼ í•  ì •ë³´:**
- ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤
- ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬
- ë‚´ë¶€ íŒŒì¼ ê²½ë¡œ
- API í‚¤ë‚˜ í† í°
- ì„œë²„ ë²„ì „ ì •ë³´

**ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤˜ì•¼ í•  ì •ë³´:**
- ë¬´ì—‡ì´ ì˜ëª»ë˜ì—ˆëŠ”ì§€ (ì¼ë°˜ì  ì„¤ëª…)
- ë‹¤ìŒì— ë¬´ì—‡ì„ í•´ì•¼ í•˜ëŠ”ì§€
- ë³µêµ¬ ì˜µì…˜
- ë„ì›€ì„ ë°›ëŠ” ë°©ë²•

### ì—ëŸ¬ ë¡œê¹… ì „ëµ

**ë¡œê¹…í•  ì •ë³´:**
- âœ… ì—ëŸ¬ ìœ í˜• ë° ë©”ì‹œì§€
- âœ… ì‚¬ìš©ì ID (ê°œì¸ì •ë³´ ì œì™¸)
- âœ… URL ë° ì»´í¬ë„ŒíŠ¸ ì´ë¦„
- âœ… íƒ€ì„ìŠ¤íƒ¬í”„
- âœ… ì‚¬ìš©ì ì—ì´ì „íŠ¸

**ë¡œê¹…í•˜ì§€ ë§ì•„ì•¼ í•  ì •ë³´:**
- âŒ ë¹„ë°€ë²ˆí˜¸
- âŒ API í‚¤
- âŒ ë¯¼ê°í•œ ê°œì¸ì •ë³´
- âŒ ì‹ ìš©ì¹´ë“œ ì •ë³´
- âŒ ì„¸ì…˜ í† í°
